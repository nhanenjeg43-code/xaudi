<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Xaudí Store</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/@fontsource/geist@5.0.3/400.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@fontsource/geist@5.0.3/600.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: 'Geist', sans-serif; }
    .card { background:#1a1a1a; border-radius:12px; overflow:hidden; border:1px solid #2d2d2d; }
    .badge { background:#10b981; color:white; padding:2px 8px; border-radius:12px; font-size:12px; }
    .btn { background:#10b981; color:white; padding:8px 16px; border-radius:8px; font-weight:500; transition:background .2s; }
    .btn:hover { background:#059669; }
    .btn-outline { background:transparent; border:1px solid #10b981; color:#10b981; }
    .btn-outline:hover { background:#10b981; color:white; }
  </style>
</head>
<body class="bg-neutral-950 text-neutral-100">

  <!-- Header -->
  <header class="p-6 text-center border-b border-neutral-800">
    <h1 class="text-3xl font-bold text-emerald-400">Xaudí Store</h1>
    <p class="text-neutral-400">Browse beats, music, sample packs & presets</p>
  </header>

  <!-- Search, Filters & Sort -->
  <section class="p-6 flex flex-col md:flex-row gap-4 items-center justify-center flex-wrap">
    <input id="searchInput" type="text" placeholder="Search by title or tag..."
      class="w-full md:w-1/3 px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-white">
    <input id="minPrice" type="number" placeholder="Min Price"
      class="w-32 px-3 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-white">
    <input id="maxPrice" type="number" placeholder="Max Price"
      class="w-32 px-3 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-white">
    <select id="sortSelect" class="w-48 px-3 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-white">
      <option value="newest">Sort: Newest</option>
      <option value="lowPrice">Sort: Lowest Price</option>
      <option value="highPrice">Sort: Highest Price</option>
      <option value="title">Sort: Title (A–Z)</option>
    </select>
    <button id="filterBtn" class="btn">Apply Filters</button>
    <button id="clearBtn" class="btn-outline px-6 py-2 rounded-lg">Clear Filters</button>
  </section>

  <!-- Categories -->
  <main class="space-y-12">
    <section class="p-6">
      <h2 class="text-2xl font-bold mb-4">Beats</h2>
      <div id="beats-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </section>

    <section class="p-6">
      <h2 class="text-2xl font-bold mb-4">Music</h2>
      <div id="music-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </section>

    <section class="p-6">
      <h2 class="text-2xl font-bold mb-4">Sample Packs</h2>
      <div id="sample-packs-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </section>

    <section class="p-6">
      <h2 class="text-2xl font-bold mb-4">Vocal Presets</h2>
      <div id="vocal-presets-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </section>
  </main>

  <script>
    // Supabase config
    const supabaseUrl = "https://benynilplzcrywrpikom.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJlbnluaWxwbHpjcnl3cnBpa29tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5NzIwODIsImV4cCI6MjA3MjU0ODA4Mn0.vRlyXxQ35-2rnkxFkhxX9XbdPkfXqxIduTB1Ed4KjUk";
    const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

    let allProducts = [];

    // Fetch products
    async function loadProducts() {
      try {
        const { data: products, error } = await supabaseClient
          .from("products")
          .select("*")
          .order("id", { ascending: false });

        if (error) throw error;
        allProducts = products;
        applyFilters(); // show initial view
      } catch (err) {
        console.error(err);
        alert("Failed to load products: " + err.message);
      }
    }

    // Render products into categories
    function renderProducts(products) {
      const categories = ["beats", "music", "sample-packs", "vocal-presets"];
      categories.forEach(cat => {
        const container = document.getElementById(`${cat}-container`);
        if (container) container.innerHTML = "";
      });

      products.forEach(product => {
        const card = document.createElement("div");
        card.className = "card p-4 space-y-3";

        card.innerHTML = `
          <img src="${product.cover_url}" class="w-full h-48 object-cover rounded-lg" alt="${product.title}">
          <div>
            <h3 class="text-lg font-semibold">${product.title}</h3>
            <p class="text-sm text-neutral-400">${product.category}</p>
            <p class="text-lg font-bold text-emerald-400">R${product.price}</p>
          </div>
          <div class="flex flex-wrap gap-2">
            ${product.tags ? product.tags.split(',').map(tag => `<span class="badge">${tag.trim()}</span>`).join('') : ""}
          </div>
          <audio controls class="w-full mt-2">
            <source src="${product.audio_url}" type="audio/mpeg">
            Your browser does not support the audio element.
          </audio>
          <a href="${product.download_link}" target="_blank" class="btn block text-center mt-3">Download</a>
        `;

        const container = document.getElementById(`${product.category}-container`);
        if (container) container.appendChild(card);
      });
    }

    // Apply search, filters & sort
    function applyFilters() {
      const searchValue = document.getElementById("searchInput").value.toLowerCase();
      const minPrice = parseFloat(document.getElementById("minPrice").value) || 0;
      const maxPrice = parseFloat(document.getElementById("maxPrice").value) || Infinity;
      const sortBy = document.getElementById("sortSelect").value;

      let filtered = allProducts.filter(p => {
        const matchesSearch =
          p.title.toLowerCase().includes(searchValue) ||
          (p.tags && p.tags.toLowerCase().includes(searchValue));
        const matchesPrice = p.price >= minPrice && p.price <= maxPrice;
        return matchesSearch && matchesPrice;
      });

      // Sorting
      switch (sortBy) {
        case "lowPrice":
          filtered.sort((a, b) => a.price - b.price);
          break;
        case "highPrice":
          filtered.sort((a, b) => b.price - a.price);
          break;
        case "title":
          filtered.sort((a, b) => a.title.localeCompare(b.title));
          break;
        default: // newest
          filtered.sort((a, b) => b.id - a.id);
      }

      renderProducts(filtered);
    }

    // Clear filters
    function clearFilters() {
      document.getElementById("searchInput").value = "";
      document.getElementById("minPrice").value = "";
      document.getElementById("maxPrice").value = "";
      document.getElementById("sortSelect").value = "newest";
      renderProducts(allProducts);
    }

    document.getElementById("filterBtn").addEventListener("click", applyFilters);
    document.getElementById("searchInput").addEventListener("input", applyFilters);
    document.getElementById("sortSelect").addEventListener("change", applyFilters);
    document.getElementById("clearBtn").addEventListener("click", clearFilters);

    // Load products on page ready
    document.addEventListener("DOMContentLoaded", loadProducts);
  </script>
</body>
</html>

