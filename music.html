<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Music - Xaudi</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: sans-serif; }
    .card { background:#1a1a1a; border-radius:12px; overflow:hidden; border:1px solid #2d2d2d; }
    .badge { background:#10b981; color:white; padding:2px 8px; border-radius:12px; font-size:12px; }
    .btn { background:#10b981; color:white; padding:8px 16px; border-radius:8px; font-weight:500; transition:background .2s; }
    .btn:hover { background:#059669; }
    .dropdown { display: none; }
    .dropdown.open { display: block; }
  </style>
</head>
<body class="bg-neutral-950 text-neutral-100 min-h-screen">

  <!-- ✅ Navbar -->
  <header class="sticky top-0 z-40 backdrop-blur bg-neutral-950/70 border-b border-neutral-800">
    <nav class="max-w-7xl mx-auto px-4 flex items-center justify-between h-16">
      <a href="index.html" class="text-xl font-bold text-emerald-400">Xaudi</a>
      <div class="flex items-center gap-6">
        <a href="index.html" class="hover:text-emerald-400">Homepage</a>
        <div class="relative">
          <button id="categoriesBtn" class="hover:text-emerald-400">Categories ▼</button>
          <div id="categoriesMenu" class="dropdown absolute bg-neutral-900 border border-neutral-700 mt-2 rounded-lg shadow-lg">
            <a href="beats.html" class="block px-4 py-2 hover:bg-neutral-800">Beats</a>
            <a href="music.html" class="block px-4 py-2 hover:bg-neutral-800">Music</a>
            <a href="sample-packs.html" class="block px-4 py-2 hover:bg-neutral-800">Sample Packs</a>
            <a href="vocal-presets.html" class="block px-4 py-2 hover:bg-neutral-800">Vocal Presets</a>
          </div>
        </div>
        <button id="cartBtn" class="hover:text-emerald-400">Cart</button>
      </div>
    </nav>
  </header>

  <!-- ✅ Cart Drawer -->
  <div id="cartDrawer" class="fixed top-0 right-0 w-80 h-full bg-neutral-900 border-l border-neutral-800 transform translate-x-full transition-transform duration-300 z-50">
    <div class="p-4 flex justify-between items-center border-b border-neutral-800">
      <h2 class="text-xl font-bold">Your Cart</h2>
      <button id="closeCart" class="text-red-400 hover:text-red-300">✕</button>
    </div>
    <div id="cartItems" class="p-4 space-y-4"></div>
    <div class="p-4 border-t border-neutral-800">
      <button class="btn w-full">Checkout</button>
    </div>
  </div>

  <!-- ✅ Page Title -->
  <main class="max-w-6xl mx-auto px-4 py-10">
    <h1 class="text-3xl font-bold text-emerald-400 mb-6">Music</h1>

    <!-- ✅ Search + Price Filter -->
    <div class="mb-6 flex flex-col md:flex-row gap-4">
      <input id="search-input" type="text" placeholder="Search music..."
        class="w-full md:w-1/3 px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-white">
      <select id="price-filter"
        class="px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-white">
        <option value="">All Prices</option>
        <option value="low">Under R100</option>
        <option value="mid">R100 - R500</option>
        <option value="high">Above R500</option>
      </select>
    </div>

    <!-- ✅ Products Grid -->
    <div id="music-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
  </main>

  <script>
    // ✅ Supabase Setup
    const supabaseUrl = "https://benynilplzcrywrpikom.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJlbnluaWxwbHpjcnl3cnBpa29tIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1Njk3MjA4MiwiZXhwIjoyMDcyNTQ4MDgyfQ.7bb1ot2YS7eEsaT6fHbMwfjbvT5kS_Me8spWgsS3LoE"; // replace with your anon key
    const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

    let allProducts = [];
    let cart = [];

    // ✅ Fetch Music
    async function loadMusic() {
      const { data: products, error } = await supabaseClient
        .from("products")
        .select("*")
        .eq("category", "music")
        .order("id", { ascending: false });

      if (error) { console.error(error); return; }
      allProducts = products;
      renderMusic(products);
    }

    // ✅ Render Music
    function renderMusic(products) {
      const container = document.getElementById("music-container");
      container.innerHTML = "";
      products.forEach(product => {
        const card = document.createElement("div");
        card.className = "card p-4 space-y-3";
        card.innerHTML = `
          <img src="${product.cover_url}" class="w-full h-48 object-cover rounded-lg" alt="${product.title}">
          <div>
            <h3 class="text-lg font-semibold">${product.title}</h3>
            <p class="text-sm text-neutral-400">${product.category}</p>
            <p class="text-lg font-bold text-emerald-400">R${product.price}</p>
          </div>
          <div class="flex flex-wrap gap-2">
            ${product.tags ? product.tags.split(',').map(tag => `<span class="badge">${tag.trim()}</span>`).join('') : ""}
          </div>
          <audio controls class="w-full mt-2">
            <source src="${product.audio_url}" type="audio/mpeg">
          </audio>
          <button onclick="addToCart(${product.id})" class="btn w-full mt-3">Add to Cart</button>
        `;
        container.appendChild(card);
      });
    }

    // ✅ Filtering
    function applyFilters() {
      const search = document.getElementById("search-input").value.toLowerCase();
      const price = document.getElementById("price-filter").value;
      let filtered = allProducts.filter(p => {
        let matchesSearch = p.title.toLowerCase().includes(search) || (p.tags && p.tags.toLowerCase().includes(search));
        let matchesPrice = true;
        if (price === "low") matchesPrice = p.price < 100;
        else if (price === "mid") matchesPrice = p.price >= 100 && p.price <= 500;
        else if (price === "high") matchesPrice = p.price > 500;
        return matchesSearch && matchesPrice;
      });
      renderMusic(filtered);
    }

    document.getElementById("search-input").addEventListener("input", applyFilters);
    document.getElementById("price-filter").addEventListener("change", applyFilters);

    // ✅ Cart Functions
    function addToCart(productId) {
      const product = allProducts.find(p => p.id === productId);
      if (!product) return;
      cart.push(product);
      renderCart();
    }

    function renderCart() {
      const cartItems = document.getElementById("cartItems");
      cartItems.innerHTML = "";
      cart.forEach((item, index) => {
        const div = document.createElement("div");
        div.className = "flex justify-between items-center bg-neutral-800 p-2 rounded";
        div.innerHTML = `
          <div>
            <p class="font-semibold">${item.title}</p>
            <p class="text-sm text-neutral-400">R${item.price}</p>
          </div>
          <button onclick="removeFromCart(${index})" class="text-red-400 hover:text-red-300">Remove</button>
        `;
        cartItems.appendChild(div);
      });
    }

    function removeFromCart(index) {
      cart.splice(index, 1);
      renderCart();
    }

    // ✅ Cart Drawer Toggle
    document.getElementById("cartBtn").addEventListener("click", () => {
      document.getElementById("cartDrawer").classList.remove("translate-x-full");
    });
    document.getElementById("closeCart").addEventListener("click", () => {
      document.getElementById("cartDrawer").classList.add("translate-x-full");
    });

    // ✅ Categories Dropdown Toggle
    const categoriesBtn = document.getElementById("categoriesBtn");
    const categoriesMenu = document.getElementById("categoriesMenu");
    categoriesBtn.addEventListener("click", () => {
      categoriesMenu.classList.toggle("open");
    });

    // ✅ Init
    document.addEventListener("DOMContentLoaded", loadMusic);
  </script>
</body>
</html>
