<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Upload - Xaudi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fontsource/geist@5.0.3/400.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fontsource/geist@5.0.3/600.css" rel="stylesheet">
    <style>
        body { font-family: 'Geist', sans-serif; }
        .upload-status {
            display: none;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .upload-success {
            background-color: #d4edda;
            color: #155724;
            display: block;
        }
        .upload-error {
            background-color: #f8d7da;
            color: #721c24;
            display: block;
        }
        .upload-loading {
            background-color: #d1ecf1;
            color: #0c5460;
            display: block;
        }
        .waveform {
            height: 40px;
            background: #2d3748;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        .waveform-bar {
            position: absolute;
            bottom: 0;
            background: #10b981;
            width: 3px;
            border-radius: 1px 1px 0 0;
        }
        .audio-player {
            width: 100%;
            margin-top: 8px;
        }
        .card {
            background: #1a1a1a;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #2d2d2d;
        }
        .badge {
            background: #10b981;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        .btn {
            background: #10b981;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 500;
            transition: background 0.2s;
        }
        .btn:hover {
            background: #059669;
        }
    </style>
</head>
<body class="bg-neutral-950 text-neutral-100 flex items-center justify-center min-h-screen p-4">

<div id="password-screen" class="w-full max-w-sm p-6 bg-neutral-900 rounded-2xl border border-neutral-800 shadow-lg">
    <h2 class="text-2xl font-bold mb-4 text-center">Admin Login</h2>
    <input id="password-input" type="password" placeholder="Enter password" class="w-full px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-emerald-500 text-white">
    <p id="error-text" class="text-red-400 text-sm mb-3 hidden">Incorrect password. Try again.</p>
    <button onclick="checkPassword()" class="w-full bg-emerald-600 text-white py-2 rounded-lg hover:bg-emerald-700 transition-colors">Login</button>
</div>

<div id="upload-form" class="hidden w-full max-w-4xl p-6 bg-neutral-900 rounded-2xl border border-neutral-800 shadow-lg">
    <h2 class="text-2xl font-bold mb-4 text-center">Upload Product</h2>
    <div id="upload-status" class="upload-status"></div>
    
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div>
            <form id="form" class="space-y-4">
                <div>
                    <input type="text" id="title" placeholder="Product Title" required 
                           class="w-full px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-white">
                </div>
                
                <div>
                    <select id="category" required 
                            class="w-full px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-white">
                        <option value="">Select Category</option>
                        <option value="beats">Beats</option>
                        <option value="music">Music</option>
                        <option value="sample-packs">Sample Packs</option>
                        <option value="vocal-presets">Vocal Presets</option>
                    </select>
                </div>
                
                <div>
                    <input type="number" id="price" step="0.01" placeholder="Price" required 
                           class="w-full px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-white">
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-neutral-300 mb-1">Cover Image URL</label>
                        <input type="text" id="cover" placeholder="https://example.com/image.jpg" required 
                               class="w-full px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-white">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-neutral-300 mb-1">Audio Preview URL</label>
                        <input type="text" id="audio" placeholder="https://example.com/audio.mp3" 
                               class="w-full px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-white"
                               value="assets/audio/silence.wav">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div id="bpm-field">
                        <label class="block text-sm font-medium text-neutral-300 mb-1">BPM (for beats/music)</label>
                        <input type="number" id="bpm" placeholder="120" 
                               class="w-full px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-white">
                    </div>
                    
                    <div id="key-field">
                        <label class="block text-sm font-medium text-neutral-300 mb-1">Key (for beats/music)</label>
                        <input type="text" id="key" placeholder="Cmin" 
                               class="w-full px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-white">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div id="daw-field" class="hidden">
                        <label class="block text-sm font-medium text-neutral-300 mb-1">DAW (for vocal presets)</label>
                        <input type="text" id="daw" placeholder="FL Studio, Ableton, etc." 
                               class="w-full px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-white">
                    </div>
                    
                    <div id="files-field" class="hidden">
                        <label class="block text-sm font-medium text-neutral-300 mb-1">Number of Files (for sample packs)</label>
                        <input type="number" id="files" placeholder="50" 
                               class="w-full px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-white">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-neutral-300 mb-1">Tags (comma separated)</label>
                    <input type="text" id="tags" placeholder="Trap, Dark, HipHop" 
                           class="w-full px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-white">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-neutral-300 mb-1">Download Link</label>
                    <input type="text" id="downloadLink" placeholder="https://drive.google.com/..." required 
                           class="w-full px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-white">
                </div>
                
                <div>
                    <button type="submit" class="w-full bg-emerald-600 text-white py-2 rounded-lg hover:bg-emerald-700 transition-colors">Upload Product</button>
                </div>
            </form>
            
            <div class="mt-6 text-center">
                <a href="index.html" class="text-emerald-400 hover:text-emerald-300">← Back to Homepage</a>
                <button onclick="logout()" class="ml-4 text-red-400 hover:text-red-300">Logout</button>
            </div>
        </div>
        
        <!-- Preview Section -->
        <div>
            <h3 class="text-lg font-semibold mb-4">Product Preview</h3>
            <div id="product-preview" class="card">
                <img id="preview-cover" class="w-full h-48 object-cover" src="https://images.pexels.com/photos/164745/pexels-photo-164745.jpeg?auto=compress&cs=tinysrgb&w=640&h=400&dpr=2" alt="Preview cover">
                <div class="p-4 space-y-3">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 id="preview-title" class="font-medium">Product Title</h3>
                            <p id="preview-subtitle" class="text-xs text-neutral-400">Details will appear here</p>
                        </div>
                        <div class="text-right">
                            <p id="preview-price" class="text-lg font-semibold">R0</p>
                        </div>
                    </div>
                    <div id="preview-tags" class="flex flex-wrap items-center gap-2"></div>
                    
                    <!-- Audio Preview with Waveform -->
                    <div class="mt-3">
                        <div id="waveform" class="waveform"></div>
                        <audio id="audio-preview" class="audio-player" controls>
                            Your browser does not support the audio element.
                        </audio>
                    </div>
                    
                    <div class="flex items-center gap-2 pt-2">
                        <button class="btn">Add to Cart</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Admin password (change this to your preferred password)
const ADMIN_PASSWORD = 'xaudiXdx12@';

// Check if user is already logged in
if (localStorage.getItem('adminLoggedIn') === 'true') {
    document.getElementById('password-screen').classList.add('hidden');
    document.getElementById('upload-form').classList.remove('hidden');
    initForm();
}

function checkPassword() {
    const pass = document.getElementById('password-input').value;
    if(pass === ADMIN_PASSWORD) {
        localStorage.setItem('adminLoggedIn', 'true');
        document.getElementById('password-screen').classList.add('hidden');
        document.getElementById('upload-form').classList.remove('hidden');
        initForm();
    } else {
        document.getElementById('error-text').classList.remove('hidden');
    }
}

function initForm() {
    // Add event listener for category change
    document.getElementById('category').addEventListener('change', function() {
        updateFormFields();
        updatePreview();
    });
    
    // Add event listeners for input changes to update preview
    const previewFields = ['title', 'price', 'cover', 'audio', 'bpm', 'key', 'daw', 'files', 'tags'];
    previewFields.forEach(field => {
        const element = document.getElementById(field);
        if (element) {
            element.addEventListener('input', updatePreview);
        }
    });
    
    // Initialize form fields
    updateFormFields();
    generateWaveform();
}

function updateFormFields() {
    const category = document.getElementById('category').value;
    
    // Hide all optional fields first
    document.getElementById('bpm-field').classList.add('hidden');
    document.getElementById('key-field').classList.add('hidden');
    document.getElementById('daw-field').classList.add('hidden');
    document.getElementById('files-field').classList.add('hidden');
    
    // Show relevant fields based on category
    if (category === 'beats' || category === 'music') {
        document.getElementById('bpm-field').classList.remove('hidden');
        document.getElementById('key-field').classList.remove('hidden');
    } else if (category === 'vocal-presets') {
        document.getElementById('daw-field').classList.remove('hidden');
    } else if (category === 'sample-packs') {
        document.getElementById('files-field').classList.remove('hidden');
    }
}

function updatePreview() {
    const category = document.getElementById('category').value;
    const title = document.getElementById('title').value || 'Product Title';
    const price = document.getElementById('price').value || '0';
    const cover = document.getElementById('cover').value;
    const audio = document.getElementById('audio').value;
    const bpm = document.getElementById('bpm').value;
    const key = document.getElementById('key').value;
    const daw = document.getElementById('daw').value;
    const files = document.getElementById('files').value;
    const tags = document.getElementById('tags').value;
    
    // Update preview elements
    document.getElementById('preview-title').textContent = title;
    document.getElementById('preview-price').textContent = `R${price}`;
    
    if (cover) {
        document.getElementById('preview-cover').src = cover;
    }
    
    if (audio) {
        document.getElementById('audio-preview').src = audio;
    }
    
    // Update subtitle based on category
    let subtitle = '';
    if (category === 'beats' || category === 'music') {
        subtitle = `${bpm || '120'} BPM • ${key || 'Cmin'}`;
    } else if (category === 'vocal-presets') {
        subtitle = daw || 'FL Studio';
    } else if (category === 'sample-packs') {
        subtitle = `${files || '50'} files`;
    }
    document.getElementById('preview-subtitle').textContent = subtitle;
    
    // Update tags
    const tagsContainer = document.getElementById('preview-tags');
    tagsContainer.innerHTML = '';
    if (tags) {
        tags.split(',').forEach(tag => {
            if (tag.trim()) {
                const span = document.createElement('span');
                span.className = 'badge';
                span.textContent = tag.trim();
                tagsContainer.appendChild(span);
            }
        });
    }
}

function generateWaveform() {
    const waveform = document.getElementById('waveform');
    waveform.innerHTML = '';
    
    // Create a simple random waveform
    for (let i = 0; i < 100; i++) {
        const bar = document.createElement('div');
        bar.className = 'waveform-bar';
        bar.style.left = i * 4 + 'px';
        bar.style.height = Math.random() * 30 + 5 + 'px';
        waveform.appendChild(bar);
    }
}

// Handle form submission
document.getElementById('form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const title = document.getElementById('title').value;
    const category = document.getElementById('category').value;
    const price = parseFloat(document.getElementById('price').value);
    const cover = document.getElementById('cover').value;
    const audio = document.getElementById('audio').value || 'assets/audio/silence.wav';
    const bpm = document.getElementById('bpm').value;
    const key = document.getElementById('key').value;
    const daw = document.getElementById('daw').value;
    const files = document.getElementById('files').value;
    const tags = document.getElementById('tags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
    const downloadLink = document.getElementById('downloadLink').value;
    
    // Validate required fields
    if (!title || !category || !price || !cover || !downloadLink) {
        showStatus('Please fill all required fields', 'error');
        return;
    }
    
    // Create new product object
    const newProduct = {
        id: `${category}-${Date.now()}`,
        title,
        category,
        price,
        cover,
        audio,
        downloadLink,
        tags,
        dateAdded: new Date().toISOString()
    };
    
    // Add category-specific fields
    if (category === 'beats' || category === 'music') {
        newProduct.bpm = bpm || 120;
        newProduct.key = key || 'Cmin';
    }
    
    if (category === 'vocal-presets' && daw) {
        newProduct.daw = daw;
    }
    
    if (category === 'sample-packs' && files) {
        newProduct.files = parseInt(files) || 50;
    }
    
    // Save product to localStorage
    saveProduct(newProduct);
    
    // Show success message
    showStatus('Product uploaded successfully! It will now appear on the website.', 'success');
    
    // Reset form
    document.getElementById('form').reset();
    updateFormFields();
    updatePreview();
});

function saveProduct(product) {
    // Get existing products or initialize empty array
    let products = JSON.parse(localStorage.getItem('catalogProducts') || '[]');
    
    // Add new product
    products.push(product);
    
    // Save back to localStorage
    localStorage.setItem('catalogProducts', JSON.stringify(products));
    
    // Also update the specific category storage for backward compatibility
    const categoryKey = `catalog${product.category.charAt(0).toUpperCase() + product.category.slice(1).replace('-', '')}`;
    let categoryProducts = JSON.parse(localStorage.getItem(categoryKey) || '[]');
    categoryProducts.push(product);
    localStorage.setItem(categoryKey, JSON.stringify(categoryProducts));
    
    console.log(`Product saved to ${categoryKey}:`, product);
}

function showStatus(message, type) {
    const statusEl = document.getElementById('upload-status');
    statusEl.textContent = message;
    statusEl.className = 'upload-status';
    
    if (type === 'success') {
        statusEl.classList.add('upload-success');
    } else if (type === 'error') {
        statusEl.classList.add('upload-error');
    } else if (type === 'loading') {
        statusEl.classList.add('upload-loading');
    }
    
    // Auto-hide after 5 seconds
    if (type !== 'loading') {
        setTimeout(() => {
            statusEl.className = 'upload-status';
        }, 5000);
    }
}

// Add logout functionality
function logout() {
    localStorage.removeItem('adminLoggedIn');
    window.location.reload();
}
</script>

</body>
</html>
