<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Upload - Xaudi</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/@fontsource/geist@5.0.3/400.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@fontsource/geist@5.0.3/600.css" rel="stylesheet">
  <style>
    body { font-family: 'Geist', sans-serif; }
    .upload-status { display:none; padding:10px; margin:10px 0; border-radius:5px; }
    .upload-success { background:#d4edda; color:#155724; display:block; }
    .upload-error { background:#f8d7da; color:#721c24; display:block; }
    .upload-loading { background:#d1ecf1; color:#0c5460; display:block; }
    .waveform { height:40px; background:#2d3748; border-radius:4px; overflow:hidden; position:relative; }
    .waveform-bar { position:absolute; bottom:0; background:#10b981; width:3px; border-radius:1px 1px 0 0; }
    .audio-player { width:100%; margin-top:8px; }
    .card { background:#1a1a1a; border-radius:12px; overflow:hidden; border:1px solid #2d2d2d; }
    .badge { background:#10b981; color:white; padding:2px 8px; border-radius:12px; font-size:12px; }
    .btn { background:#10b981; color:white; padding:8px 16px; border-radius:8px; font-weight:500; transition:background .2s; }
    .btn:hover { background:#059669; }
  </style>
</head>
<body class="bg-neutral-950 text-neutral-100 flex items-center justify-center min-h-screen p-4">

<!-- Password screen -->
<div id="password-screen" class="w-full max-w-sm p-6 bg-neutral-900 rounded-2xl border border-neutral-800 shadow-lg">
  <h2 class="text-2xl font-bold mb-4 text-center">Admin Login</h2>
  <input id="password-input" type="password" placeholder="Enter password"
    class="w-full px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-emerald-500 text-white">
  <p id="error-text" class="text-red-400 text-sm mb-3 hidden">Incorrect password. Try again.</p>
  <button onclick="checkPassword()" class="w-full bg-emerald-600 text-white py-2 rounded-lg hover:bg-emerald-700">Login</button>
</div>

<!-- Upload form -->
<div id="upload-form" class="hidden w-full max-w-4xl p-6 bg-neutral-900 rounded-2xl border border-neutral-800 shadow-lg">
  <h2 class="text-2xl font-bold mb-4 text-center">Upload Product</h2>
  <div id="upload-status" class="upload-status"></div>
  
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div>
      <form id="form" class="space-y-4" enctype="multipart/form-data">
        <input type="text" id="title" placeholder="Product Title" required
          class="w-full px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-white">
        
        <select id="category" required
          class="w-full px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-white">
          <option value="">Select Category</option>
          <option value="beats">Beats</option>
          <option value="music">Music</option>
          <option value="sample-packs">Sample Packs</option>
          <option value="vocal-presets">Vocal Presets</option>
        </select>
        
        <input type="number" id="price" step="0.01" placeholder="Price" required
          class="w-full px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-white">
        
        <!-- File inputs -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm text-neutral-300 mb-1">Cover Image</label>
            <input type="file" id="coverFile" accept="image/*"
              class="w-full text-white">
          </div>
          <div>
            <label class="block text-sm text-neutral-300 mb-1">Audio Preview</label>
            <input type="file" id="audioFile" accept="audio/*"
              class="w-full text-white">
          </div>
        </div>

        <!-- Extra fields -->
        <div>
          <label class="block text-sm text-neutral-300 mb-1">Tags (comma separated)</label>
          <input type="text" id="tags" placeholder="Trap, Dark, HipHop"
            class="w-full px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-white">
        </div>

        <div>
          <label class="block text-sm text-neutral-300 mb-1">Download Link</label>
          <input type="text" id="downloadLink" placeholder="https://drive.google.com/..."
            required class="w-full px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-white">
        </div>
        
        <button type="submit" class="w-full bg-emerald-600 text-white py-2 rounded-lg hover:bg-emerald-700">Upload Product</button>
      </form>
      <div class="mt-6 text-center">
        <a href="index.html" class="text-emerald-400 hover:text-emerald-300">← Back</a>
        <button onclick="logout()" class="ml-4 text-red-400 hover:text-red-300">Logout</button>
      </div>
    </div>
    
    <!-- Preview -->
    <div>
      <h3 class="text-lg font-semibold mb-4">Product Preview</h3>
      <div class="card">
        <img id="preview-cover" class="w-full h-48 object-cover"
          src="https://images.pexels.com/photos/164745/pexels-photo-164745.jpeg?auto=compress&cs=tinysrgb&w=640&h=400&dpr=2" alt="Preview cover">
        
        <div class="p-4 space-y-3">
          <div class="flex items-center justify-between">
            <div>
              <h3 id="preview-title" class="font-medium">Product Title</h3>
              <p id="preview-subtitle" class="text-xs text-neutral-400">Details will appear here</p>
            </div>
            <div class="text-right">
              <p id="preview-price" class="text-lg font-semibold">R0</p>
            </div>
          </div>

          <div id="preview-tags" class="flex flex-wrap items-center gap-2"></div>

          <!-- Audio Preview with waveform -->
          <div class="mt-3">
            <div id="waveform" class="waveform"></div>
            <audio id="audio-preview" class="audio-player" controls></audio>
          </div>

          <div class="flex items-center gap-2 pt-2">
            <a id="preview-download" href="#" target="_blank" class="btn">Download</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const ADMIN_PASSWORD = "xaudiXdx12@";

// Password check
function checkPassword(){
  const pass = document.getElementById("password-input").value;
  if(pass === ADMIN_PASSWORD){
    document.getElementById("password-screen").classList.add("hidden");
    document.getElementById("upload-form").classList.remove("hidden");
    initForm();
  } else {
    document.getElementById("error-text").classList.remove("hidden");
  }
}

// Logout
function logout(){
  location.reload();
}

// Preview update on file select
document.getElementById("coverFile").addEventListener("change", e=>{
  const file = e.target.files[0];
  if(file){
    const url = URL.createObjectURL(file);
    document.getElementById("preview-cover").src = url;
    window._coverObjectUrl = url;
  }
});
document.getElementById("audioFile").addEventListener("change", e=>{
  const file = e.target.files[0];
  if(file){
    const url = URL.createObjectURL(file);
    document.getElementById("audio-preview").src = url;
    window._audioObjectUrl = url;
  }
});

// Init form + preview functions
function initForm() {
  document.getElementById('category').addEventListener('change', function() {
    updateFormFields();
    updatePreview();
  });

  const previewFields = ['title', 'price', 'tags', 'downloadLink'];
  previewFields.forEach(field => {
    const el = document.getElementById(field);
    if (el) {
      el.addEventListener('input', updatePreview);
    }
  });

  updateFormFields();
  generateWaveform();
}

function updateFormFields() {
  const category = document.getElementById('category').value;
  let subtitle = '';
  if (category === 'beats' || category === 'music') {
    subtitle = '120 BPM • Cmin';
  } else if (category === 'vocal-presets') {
    subtitle = 'FL Studio';
  } else if (category === 'sample-packs') {
    subtitle = '50 files';
  }
  document.getElementById('preview-subtitle').textContent = subtitle;
}

function updatePreview() {
  const title = document.getElementById('title').value || 'Product Title';
  const price = document.getElementById('price').value || '0';
  const tags = document.getElementById('tags').value;
  const downloadLink = document.getElementById('downloadLink').value;

  document.getElementById('preview-title').textContent = title;
  document.getElementById('preview-price').textContent = `R${price}`;
  document.getElementById('preview-download').href = downloadLink || '#';

  // Tags
  const tagsContainer = document.getElementById('preview-tags');
  tagsContainer.innerHTML = '';
  if (tags) {
    tags.split(',').forEach(tag => {
      if (tag.trim()) {
        const span = document.createElement('span');
        span.className = 'badge';
        span.textContent = tag.trim();
        tagsContainer.appendChild(span);
      }
    });
  }
}

function generateWaveform() {
  const waveform = document.getElementById('waveform');
  waveform.innerHTML = '';
  for (let i = 0; i < 100; i++) {
    const bar = document.createElement('div');
    bar.className = 'waveform-bar';
    bar.style.left = i * 4 + 'px';
    bar.style.height = Math.random() * 30 + 5 + 'px';
    waveform.appendChild(bar);
  }
}

// Save product (demo with localStorage)
document.getElementById("form").addEventListener("submit", e=>{
  e.preventDefault();
  const title = document.getElementById("title").value;
  const category = document.getElementById("category").value;
  const price = parseFloat(document.getElementById("price").value);
  const tags = document.getElementById("tags").value;
  const downloadLink = document.getElementById("downloadLink").value;
  const coverFile = document.getElementById("coverFile").files[0];
  const audioFile = document.getElementById("audioFile").files[0];

  if(!title || !category || !price || !coverFile || !audioFile || !downloadLink){
    alert("Fill all fields and upload files");
    return;
  }

  const product = {
    id: Date.now(),
    title, category, price, tags, downloadLink,
    cover: window._coverObjectUrl,
    audio: window._audioObjectUrl
  };

  let products = JSON.parse(localStorage.getItem("catalogProducts")||"[]");
  products.push(product);
  localStorage.setItem("catalogProducts", JSON.stringify(products));
  alert("Product saved!");
  e.target.reset();
  updatePreview();
});
</script>
</body>
</html>
